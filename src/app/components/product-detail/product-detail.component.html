<div class="min-h-screen bg-gray-50 pb-16" *ngIf="product">
  <!-- Header -->
  <header class="bg-white shadow-sm px-4 py-3 sticky top-0 z-20">
    <div class="flex items-center justify-between">
      <button
        (click)="goBack()"
        class="p-2 -ml-2 hover:bg-gray-100 rounded-full transition-colors">
        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
      </button>

      <h1 class="text-lg font-semibold text-gray-900">Product Details</h1>

      <button
        (click)="toggleFavorite()"
        [class.text-red-500]="isFavorite"
        [class.text-gray-400]="!isFavorite"
        class="p-2 hover:bg-gray-100 rounded-full transition-colors">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- Product Images Slider -->
  <div class="relative bg-white">
    <div class="flex overflow-x-auto scrollbar-hide snap-x snap-mandatory" #imageSlider>
      <div
        *ngFor="let image of product.images; let i = index"
        class="w-full h-80 flex-shrink-0 snap-center relative">
        <img
          [src]="image"
          [alt]="product.name"
          class="w-full h-full object-cover"
          (error)="onImageError($event)">

        <!-- Image overlay for better readability -->
        <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent pointer-events-none"></div>
      </div>
    </div>

    <!-- Image Indicators -->
    <div *ngIf="product.images.length > 1" class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
      <div
        *ngFor="let image of product.images; let i = index"
        [class.bg-white]="currentImageIndex === i"
      class="w-2 h-2 rounded-full transition-colors">
    </div>
  </div>

  <!-- Stock Status Badge -->
  <div class="absolute top-4 left-4">
          <span
            [class.bg-green-500]="product.inStock"
            [class.bg-red-500]="!product.inStock"
            class="text-white text-sm px-3 py-1 rounded-full font-medium">
            {{ product.inStock ? 'In Stock' : 'Out of Stock' }}
          </span>
  </div>
</div>

<!-- Product Info -->
<div class="bg-white mx-4 mt-4 rounded-xl p-4 shadow-sm">
  <div class="flex justify-between items-start mb-3">
    <div class="flex-1 pr-4">
      <h2 class="text-xl font-semibold text-gray-900 leading-tight">{{ product.name }}</h2>
      <p class="text-sm text-gray-600 mt-1">{{ product.category }}</p>
    </div>
    <div *ngIf="product.rating" class="flex items-center bg-gray-50 px-3 py-2 rounded-lg">
      <svg class="w-4 h-4 text-yellow-400 mr-1" fill="currentColor" viewBox="0 0 20 20">
        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
      </svg>
      <span class="text-sm font-medium text-gray-700">{{ product.rating }}</span>
    </div>
  </div>

  <p class="text-3xl font-bold text-primary mb-4">\${{ product.price }}</p>

  <!-- Colors Selection -->
  <div *ngIf="product.colors && product.colors.length > 0" class="mb-6">
    <p class="text-sm font-medium text-gray-900 mb-3">Available Colors</p>
    <div class="flex space-x-3">
      <button
        *ngFor="let color of product.colors"
        [class.ring-2]="selectedColor === color"
        [class.ring-primary]="selectedColor === color"
        [class.ring-offset-2]="selectedColor === color"
        (click)="selectColor(color)"
        class="w-10 h-10 rounded-lg border-2 border-gray-200 hover:border-gray-300 transition-all duration-200 hover:scale-110"
        [style.background-color]="color">
        <span class="sr-only">Select {{ color }} color</span>
      </button>
    </div>
  </div>

  <!-- Quantity Selector -->
  <div class="mb-6">
    <p class="text-sm font-medium text-gray-900 mb-3">Quantity</p>
    <div class="flex items-center space-x-3">
      <button
        (click)="decreaseQuantity()"
        [disabled]="quantity <= 1"
        class="w-10 h-10 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
        </svg>
      </button>
      <span class="text-lg font-medium min-w-[3rem] text-center">{{ quantity }}</span>
      <button
        (click)="increaseQuantity()"
        [disabled]="quantity >= 10"
        class="w-10 h-10 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Description -->
  <div class="border-t pt-4">
    <h3 class="text-lg font-medium text-gray-900 mb-2">Description</h3>
    <p class="text-gray-600 leading-relaxed">{{ product.description }}</p>
  </div>
</div>

<!-- Related Products -->
<div *ngIf="relatedProducts.length > 0" class="mx-4 mt-4 bg-white rounded-xl p-4 shadow-sm">
  <h3 class="text-lg font-medium text-gray-900 mb-4">Related Products</h3>
  <div class="flex space-x-4 overflow-x-auto pb-2">
    <div
      *ngFor="let relatedProduct of relatedProducts"
      (click)="viewProduct(relatedProduct.id)"
      class="min-w-[120px] cursor-pointer group">
      <div class="bg-gray-50 rounded-lg p-2 mb-2 group-hover:bg-gray-100 transition-colors">
        <img
          [src]="relatedProduct.images[0]"
          [alt]="relatedProduct.name"
          class="w-full h-16 object-cover rounded"
          (error)="onImageError($event)">
      </div>
      <p class="text-xs font-medium text-gray-900 line-clamp-2">{{ relatedProduct.name }}</p>
      <p class="text-xs text-primary font-semibold">\${{ relatedProduct.price }}</p>
    </div>
  </div>
</div>

<!-- Add to Cart Button - Fixed Bottom -->
<div class="fixed bottom-16 left-4 right-4 bg-white p-4 border-t shadow-lg rounded-t-xl">
  <div class="flex space-x-3">
    <button
      (click)="addToCart()"
      [disabled]="!product.inStock || isAddingToCart"
      [class.bg-primary]="product.inStock && !isAddingToCart"
      [class.text-white]="product.inStock && !isAddingToCart"
      [class.bg-gray-300]="!product.inStock"
      [class.text-gray-500]="!product.inStock"
      [class.bg-green-500]="isAddingToCart"
      class="flex-1 py-3 rounded-xl font-semibold transition-all duration-200 disabled:cursor-not-allowed flex items-center justify-center hover:scale-105 active:scale-95">
      <div *ngIf="isAddingToCart" class="flex items-center">
        <div class="animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full mr-2"></div>
        Adding to Cart...
      </div>
      <span *ngIf="!isAddingToCart">
              {{ product.inStock ? 'Add to Cart - $' + (product.price * quantity).toFixed(2) : 'Out of Stock' }}
            </span>
    </button>

    <button
      (click)="viewCart()"
      class="bg-gray-100 text-gray-700 px-4 py-3 rounded-xl font-medium hover:bg-gray-200 transition-colors">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.5 8H18"/>
      </svg>
    </button>
  </div>
</div>

<!-- Loading State -->
<div *ngIf="!product && loading" class="min-h-screen bg-gray-50 flex items-center justify-center">
  <div class="text-center">
    <div class="animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"></div>
    <p class="text-gray-600">Loading product details...</p>
  </div>
</div>

<!-- Product Not Found -->
<div *ngIf="!product && !loading" class="min-h-screen bg-gray-50 flex items-center justify-center">
  <div class="text-center">
    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
      <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
    </div>
    <h3 class="text-lg font-medium text-gray-900 mb-1">Product Not Found</h3>
    <p class="text-gray-500 mb-4">The product you're looking for doesn't exist.</p>
    <button
      (click)="goBack()"
      class="bg-primary text-white px-4 py-2 rounded-lg font-medium hover:bg-red-600 transition-colors">
      Go Back
    </button>
  </div>
</div>

<!-- Toast -->
<div
  *ngIf="showToast"
  class="fixed bottom-32 left-4 right-4 bg-green-500 text-white px-4 py-3 rounded-lg shadow-lg z-30 flex items-center animate-slide-up">
  <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
  </svg>
  <span>{{ toastMessage }}</span>
</div>
